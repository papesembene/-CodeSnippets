#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use App\Core\DataBase;
use App\Seeders\CodeSnippetSeeder;

echo "ğŸš€ Configuration de l'application Code Snippets...\n\n";

try {
    // Connexion Ã  la base de donnÃ©es
    echo "ğŸ“¡ Connexion Ã  la base de donnÃ©es...\n";
    $db = DataBase::getInstance();
    $connection = $db->getConnection();
    echo "âœ… Connexion rÃ©ussie!\n\n";

    // ExÃ©cution de la migration
    echo "ğŸ“‹ ExÃ©cution de la migration...\n";
    $migrationSql = file_get_contents(__DIR__ . '/../database/migrations/2025_02_08_000001_create_code_snippets_table.sql');
    $connection->exec($migrationSql);
    echo "âœ… Table code_snippets crÃ©Ã©e!\n\n";

    // ExÃ©cution du seeder
    echo "ğŸŒ± Ajout des donnÃ©es d'exemple...\n";
    $seeder = new CodeSnippetSeeder();
    $seeder->run();
    echo "\n";

    echo "ğŸ‰ Configuration terminÃ©e avec succÃ¨s!\n";
    echo "ğŸŒ Vous pouvez maintenant lancer l'application avec: composer serve\n";

} catch (Exception $e) {
    echo "âŒ Erreur lors de la configuration: " . $e->getMessage() . "\n";
    exit(1);
}
